<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  
  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="bower_components/layout/layout.html">
  
  <link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
  <link rel="import" href="bower_components/iron-icons/iron-icons.html">
  
  <link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
  <link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
  <link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
  <link rel="import" href="bower_components/paper-button/paper-button.html">
  <link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
  <link rel="import" href="bower_components/paper-menu/paper-menu.html">
  <link rel="import" href="bower_components/paper-item/paper-icon-item.html">
  
  <link rel="import" href="bower_components/neon-animation/neon-animated-pages.html">
  
  <link rel="import" href="elements/game-space/game-space.html">
  <link rel="import" href="elements/user-score/user-score.html">
  <link rel="import" href="elements/selection-dialog/selection-dialog.html">
  
  <link rel="import" href="helpers/array-shuffle/array-shuffle.html">
  
  <title></title>
  
  <style>
  body{
    margin: 0;
    height: 100vh;
  }
  </style>
</head>
<body>
  <dom-module id="page-element">
    <style>
    paper-drawer-panel paper-header-panel[drawer]{
      background: #ffffff;
      height: 100%;
    }
    paper-drawer-panel paper-header-panel[main]{
      z-index: 0;
      height: 100%;
    }
    paper-toolbar{
      background: #318CE7 !important;
      padding: 0 8px;
    }
    selection-dialog paper-button::shadow{
      width: 100%;
      background: #ffffff;
    }
    selection-dialog paper-button::shadow paper-material{
      font-size: 5vh;
      padding: 4vh 0;
    }
    #home{
      background: #e5e5e5;
    }
    #home > paper-button{
      margin: 1.5vh 3vh;
      background: #ffffff;
      color: #1a1a1a;
    }
    #home paper-button.large-font::shadow paper-material{
      font-size: 4vh;
    }
    #home > .padder{
      height: 1.5vh;
    }
    </style>
    <template>
      <neon-animated-pages class="fit" selected="{{page}}" attr-for-selected="id" transitions="cross-fade-all">
        <section id="home" class="vertical layout">
          <div class="flex"></div>
          <paper-button raised class="large-font" on-tap="_btnPlayAction">Play</paper-button>
          <paper-button raised class="large-font" hidden$="[[loggedin]]" on-tap="_btnLoginAction">Login</paper-button>
          <paper-button raised class="large-font" hidden$="[[!loggedin]]" on-tap="_btnChallengeAction">Challenge</paper-button>
          <paper-button raised class="large-font" hidden$="[[!loggedin]]" on-tap="_btnLogoutAction">Logout</paper-button>
          <div class="padder"></div>
          <selection-dialog id="difficulty-dialog">
            <h1>Select Difficulty</h1>
            <div></div>
            <paper-button raised elevation="1" data-difficulty="0" on-tap="_btnSetDifficultyAction">Easy</paper-button>
            <paper-button raised elevation="2" data-difficulty="1" on-tap="_btnSetDifficultyAction">Medium</paper-button>
            <paper-button raised elevation="3" data-difficulty="2" on-tap="_btnSetDifficultyAction">Hard</paper-button>
            <div></div>
          </selection-dialog>
        </section>
        <section id="ingame">
          <paper-drawer-panel force-narrow disable-edge-swipe>
            <paper-header-panel drawer>
              <paper-toolbar justify="start">Menu</paper-toolbar>
              <paper-menu on-iron-select="_menuSelectAction">
                <paper-icon-item id="menu-item-new">
                  <iron-icon icon="icons:refresh" item-icon></iron-icon>New Level
                </paper-icon-item>
                <paper-icon-item id="menu-item-exit" class="new-section">
                  <iron-icon icon="cancel" item-icon></iron-icon>Exit
                </paper-icon-item>
              </paper-menu>
            </paper-header-panel>
            <paper-header-panel main>
              <paper-toolbar justify="center">
                <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                <div class="flex"></div>
                <user-score score="{{score}}"></user-score>
              </paper-toolbar>
              <game-space class="fit" id="game-space" url-data-path="[[dataPath]]" score="{{score}}" difficulty="{{difficulty}}" letter-tile-src="assets/images/tiles.png" tile-size="144"></game-space>
            </paper-header-panel>
          </paper-drawer-panel>
        </section>
      </neon-animated-pages>
    </template>
  </dom-module>
  <script>
    Polymer({
      is: 'page-element',
      
      properties: {
        /**
         * The name of currently active page.
         */
        page: {
          type: String,
          value: 'home',
          observer: '_pageChangeEvent'
        },
        
        /**
         * The path to the json data.
         */
        dataPath: {
          type: String,
          value: 'http://still-waters-3351.herokuapp.com/display',
        },
        
        /**
         * Whether or not the user is logged in
         */
        loggedin: {
          type: Boolean,
          value: false,
        }
      },
      
      /**
       * Set the active page.
       * 
       * @param name The name of the page to switch to
       */
      _pageChangeEvent: function(newPage, oldPage){
        var $this = this;
        
        // wait until every else is done.
        setTimeout(function(){
          switch(newPage){
          case 'home':
            break;
            
          case 'ingame':
            // make sure the page is layed out right
            //$this.$['picture-space'].redraw();
            //$this.$['tile-space'].redraw();
            
            $this.$['game-space'].newLevel();
            break;
          }
        }, 0);
      },
      
      /**
       * Called on-tap of the play button.
       */
      _btnPlayAction: function(){
        this.$['difficulty-dialog'].open();
      },

      /**
       * Called on-tap of the challenge button.
       */
      _btnChallengeAction: function(){
        
      },

      /**
       * Called on-tap of the login button.
       */
      _btnLoginAction: function(){
        this.loggedin = true;
      },

      /**
       * Called on-tap of the logout button.
       */
      _btnLogoutAction: function(){
        this.loggedin = false;
      },
      
      /**
       * Called on-tap of the difficulty selection buttons.
       */
      _btnSetDifficultyAction: function(e, detail){
        var btn = e.target.parentElement;
        
        // set difficulty before change to the game page
        this.difficulty = parseInt(btn.dataset.difficulty); // make sure the difficulty is a number, not a string
        this.$['difficulty-dialog'].close();                // close the dialog
        this.page = 'ingame';
      },
      
      /**
       * Called when a menu item is selected.
       */
      _menuSelectAction: function(e, detail){
        var id = detail.item.id;
        switch(id){
        case 'menu-item-new':
          this.$['game-space'].newLevel();
        break;
        
        case 'menu-item-exit':
          this.page = 'home';
          break;
        
        default:
          console.log('Menu item selected: ' + id);
          break;
        }
        
        Polymer.dom(e.target).querySelector('.iron-selected').blur(); // unfocuse the item
        e.target.selected = -1; // deselect the item
        Polymer.dom(this.$.ingame).querySelector('paper-drawer-panel').closeDrawer(); // close the drawer
      }
    });
  </script>
  
  <page-element></page-element>
</body>
</html>