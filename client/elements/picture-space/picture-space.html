<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="picture-space">
  <style>
  :host{
    position: relative;
    display: block;
    background: yellow;
    height: 60%;
    overflow: hidden;
  }
  :host ::content picture-element{
    position: absolute !important;
    left: 0;
    top: 0;
  }
  </style>
  <template>
    <div hidden$="[[loading]]">
      <content select="picture-element" id="pictures"></content>
      <content></content>
    </div>
  </template>
</dom-module>

<script>
Polymer({
  is: 'picture-space',
  
  properties: {
    /**
     * Selected Picture Element.
     * Used to indecate with picture element is currently active
     * and can have letter-tiles put in it.
     */
    selectedPicturelElementIndex: {
      type: Number,
      value: 0,
      notify: true
    },
    
    /**
     * Set to true if this element's children are not ready to display yet
     */
    loading:{
      type: Boolean,
      value: false
    }
  },
    
  ready: function(){
    var $this = this;
    window.addEventListener('resize', function(){
      $this.layoutPictureElements();
    });
  },
  
  /**
   * Make sure all the picture-element children are the right size,
   * then re-layout them out.
   */
  redraw: function(){
    var $this = this;
    
    // wait until everything else is done
    setTimeout(function(){
      var pictureElements = $this.getPictureElements();
      
      // make sure everything is the right size
      pictureElements.forEach(function(element, index, array){
        element.maintainAspectRatio();
      }, $this);
      
      $this.layoutPictureElements();  // then layout the picture-elements
    }, 0);
  },
  
  /**
   * Get the distributed picture-element children of this element.
   */
  getPictureElements: function(){
    return Polymer.dom(this.$.pictures).getDistributedNodes();
  },
  
  /**
   * Layout the picture-element's children.
   */
  layoutPictureElements: function(){
    Polymer.dom.flush();
    
    var pictureElements = this.getPictureElements();
    if(!pictureElements.length) return;
    
    // hard coded example of layout
    var element = Polymer.dom(pictureElements[this.selectedPicturelElementIndex]).node;
    var width  = Polymer.dom(this).node.offsetWidth;
    var height = Polymer.dom(this).node.offsetHeight;
    var zIndex = pictureElements.length;
    var scale = 1;
    var s;
    
    element.style.left = ((width  - element.offsetWidth  * scale) * 0.50) + 'px';
    element.style.top  = ((height - element.offsetHeight * scale) * 0.80) + 'px';
    element.style.zIndex = zIndex--;
    s = 'scale('+scale+')';
    element.style.WebkitTransform = s;
    element.style.msTransform = s;
    element.style.transform = s;
    
    element = pictureElements[1];
    scale = 0.5;
    element.style.left = ((width  - element.offsetWidth  * scale) * 0.05) + 'px';
    element.style.top  = ((height - element.offsetHeight * scale) * 0.50) + 'px';
    element.style.zIndex = zIndex--;
    s = 'scale('+scale+')';
    element.style.WebkitTransform = s;
    element.style.msTransform = s;
    element.style.transform = s;

    element = pictureElements[2];
    scale = 0.5;
    element.style.left = ((width  - element.offsetWidth  * scale) * 0.95) + 'px';
    element.style.top  = ((height - element.offsetHeight * scale) * 0.50) + 'px';
    element.style.zIndex = zIndex--;
    s = 'scale('+scale+')';
    element.style.WebkitTransform = s;
    element.style.msTransform = s;
    element.style.transform = s;
  }
});
</script>
